<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>JubileeVerse - Reset Password</title>
  <link rel="icon" type="image/png" href="/images/personas/jubilee.png">
  <link rel="apple-touch-icon" href="/images/personas/jubilee.png">
  <link href="https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,500;1,600&display=swap" rel="stylesheet">
  <style>
    @font-face {
      font-family: 'Agency FB';
      font-weight: bold;
      font-display: swap;
      src: url('/fonts/AGENCYB.TTF');
    }
    @font-face {
      font-family: 'Agency FB';
      font-display: swap;
      src: url('/fonts/AGENCYR.TTF');
    }
  </style>
  <link rel="stylesheet" href="/css/forgot-password.css">
</head>
<body>
  <!-- Animated waving yellow bar -->
  <div class="wave-bar"></div>

  <div class="forgot-container">
    <div class="forgot-row">
      <!-- Left Panel - Form -->
      <div class="forgot-form-panel">
        <div class="forgot-form-content">
          <div class="forgot-form-inner">
            <!-- Logo -->
            <div class="forgot-logo">
              <a href="/">
                <img src="/images/personas/jubilee.png" alt="JubileeVerse" class="forgot-logo-img">
                <div class="forgot-logo-text">
                  Jubilee<span class="verse">Verse</span><span class="dotcom">.com</span>
                </div>
              </a>
            </div>

            <!-- Initial Form State -->
            <div id="form-state">
              <!-- Welcome Text -->
              <div class="forgot-welcome">
                <p>Enter your registered email address and we will send you instructions to reset your password.</p>
              </div>

              <!-- Alert container -->
              <div id="auth-alert" class="auth-alert" style="display: none;"></div>

              <!-- Forgot Password Form -->
              <form id="forgot-form" class="forgot-form" novalidate>
                <!-- Email Field -->
                <div class="floating-label-group">
                  <input
                    type="email"
                    class="form-control"
                    id="email"
                    name="email"
                    autocomplete="email"
                    tabindex="1"
                    placeholder=" "
                    required
                  >
                  <label class="floating-label">Email Address</label>
                  <span class="field-error" id="email-error"></span>
                </div>

                <!-- Submit Button -->
                <button type="submit" class="btn-forgot" id="submit-btn" tabindex="2">
                  Continue
                </button>
              </form>

              <!-- Back to Login Link -->
              <div class="back-to-login">
                <a href="/login">Back to Sign In</a>
              </div>
            </div>

            <!-- Success State -->
            <div id="success-state" style="display: none;">
              <div class="success-content">
                <div class="success-icon">
                  <svg viewBox="0 0 24 24" width="80" height="80" fill="none" stroke="#4ade80" stroke-width="2">
                    <path d="M22 12c0 5.523-4.477 10-10 10S2 17.523 2 12 6.477 2 12 2"/>
                    <path d="M22 4L12 14.01l-3-3.01"/>
                  </svg>
                </div>
                <h2>Check Your Email</h2>
                <p>
                  Please check the email address <strong id="sent-email"></strong> for instructions to reset your password.
                </p>
                <button class="btn-forgot" id="resend-btn">
                  Resend Email
                </button>
                <div class="back-to-login">
                  <a href="/login">Back to Sign In</a>
                </div>
              </div>
            </div>

            <!-- Footer -->
            <div class="forgot-footer">
              <p class="copyright">
                &copy; <span id="currentYear"></span> JubileeVerse.com |
                <a href="/terms">Terms of Use</a> |
                <a href="/privacy">Privacy Policy</a>
              </p>
            </div>
          </div>
        </div>
      </div>

      <!-- Right Panel - Background Image -->
      <div class="forgot-bg-panel" id="backgroundImageContainer">
        <div class="bg-overlay"></div>
        <ul class="bg-bubbles">
          <li></li>
          <li></li>
          <li></li>
          <li></li>
          <li></li>
          <li></li>
          <li></li>
          <li></li>
          <li></li>
          <li></li>
        </ul>
        <div class="bg-content">
          <div class="bg-quote">
            <blockquote>
              "Come to me, all you who are weary and burdened, and I will give you rest."
            </blockquote>
            <cite>Matthew 11:28</cite>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Set current year
      document.getElementById('currentYear').textContent = new Date().getFullYear();

      // Background image rotation
      var backgroundImages = [
        '/images/slider/login-bg.jpg',
        '/images/slider/slider-bg-2.jpg',
        '/images/slider/slider-bg-3.jpg',
        '/images/slider/slider-bg-4.jpg',
        '/images/slider/slider-bg-5.jpg'
      ];
      var bgContainer = document.getElementById('backgroundImageContainer');

      function changeBackgroundImage() {
        var randomIndex = Math.floor(Math.random() * backgroundImages.length);
        bgContainer.style.backgroundImage = "url('" + backgroundImages[randomIndex] + "')";
      }

      // Set initial background and rotate every 4 seconds
      changeBackgroundImage();
      setInterval(changeBackgroundImage, 4000);

      // Form elements
      var form = document.getElementById('forgot-form');
      var emailInput = document.getElementById('email');
      var submitBtn = document.getElementById('submit-btn');
      var alertEl = document.getElementById('auth-alert');
      var formState = document.getElementById('form-state');
      var successState = document.getElementById('success-state');
      var sentEmailEl = document.getElementById('sent-email');
      var resendBtn = document.getElementById('resend-btn');

      // Form submission
      form.addEventListener('submit', async function(e) {
        e.preventDefault();

        // Clear previous errors
        clearErrors();

        // Validate
        var hasErrors = false;

        if (!emailInput.value.trim()) {
          showFieldError('email', 'Email is required');
          hasErrors = true;
        } else if (!isValidEmail(emailInput.value)) {
          showFieldError('email', 'Please enter a valid email');
          hasErrors = true;
        }

        if (hasErrors) return;

        // Submit
        submitBtn.disabled = true;
        submitBtn.innerHTML = '<span class="spinner"></span> Sending...';

        try {
          var response = await fetch('/auth/forgot-password', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              email: emailInput.value.trim()
            })
          });

          var data = await response.json();

          if (response.ok && data.success) {
            // Show success state
            sentEmailEl.textContent = emailInput.value.trim();
            formState.style.display = 'none';
            successState.style.display = 'block';
          } else {
            showAlert('error', data.error || 'Failed to send reset email. Please try again.');
            submitBtn.disabled = false;
            submitBtn.textContent = 'Continue';
          }
        } catch (error) {
          showAlert('error', 'An error occurred. Please try again.');
          submitBtn.disabled = false;
          submitBtn.textContent = 'Continue';
        }
      });

      // Resend button
      resendBtn.addEventListener('click', async function() {
        resendBtn.disabled = true;
        resendBtn.innerHTML = '<span class="spinner"></span> Sending...';

        try {
          var response = await fetch('/auth/forgot-password', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              email: emailInput.value.trim()
            })
          });

          var data = await response.json();

          if (response.ok && data.success) {
            resendBtn.textContent = 'Email Sent!';
            setTimeout(function() {
              resendBtn.disabled = false;
              resendBtn.textContent = 'Resend Email';
            }, 3000);
          } else {
            resendBtn.disabled = false;
            resendBtn.textContent = 'Resend Email';
          }
        } catch (error) {
          resendBtn.disabled = false;
          resendBtn.textContent = 'Resend Email';
        }
      });

      function showFieldError(field, message) {
        var input = document.getElementById(field);
        var error = document.getElementById(field + '-error');
        if (input) input.classList.add('is-error');
        if (error) error.textContent = message;
      }

      function clearErrors() {
        document.querySelectorAll('.form-control').forEach(function(input) {
          input.classList.remove('is-error');
        });
        document.querySelectorAll('.field-error').forEach(function(error) {
          error.textContent = '';
        });
        alertEl.style.display = 'none';
      }

      function showAlert(type, message) {
        alertEl.className = 'auth-alert auth-alert--' + type;
        alertEl.textContent = message;
        alertEl.style.display = 'flex';
      }

      function isValidEmail(email) {
        return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
      }

      // Enter key on email input
      emailInput.addEventListener('keydown', function(e) {
        if (e.key === 'Enter') {
          e.preventDefault();
          form.dispatchEvent(new Event('submit'));
        }
      });
    });
  </script>
</body>
</html>
