<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Launch Control - JubileeVerse</title>
  <link rel="stylesheet" href="/css/admin-header.css">
  <link rel="stylesheet" href="/css/admin-sidebar.css">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      background: #0a0a0a;
      min-height: 100vh;
      overflow: hidden;
    }

    /* Position sidebar container */
    #admin-sidebar-container {
      position: fixed;
      top: 36px;
      left: 0;
      height: calc(100vh - 36px);
      z-index: 100;
    }

    /* Main content area - positioned after header and sidebar */
    .launch-main-content {
      position: absolute;
      top: 36px; /* Below admin header */
      left: 60px; /* After admin sidebar */
      right: 0;
      bottom: 0;
      background: url('/images/launch.jpg') no-repeat center center;
      background-size: cover;
      overflow: hidden;
    }

    #launchPad {
      position: absolute;
      bottom: 5px;
      left: calc(48% + 5px);
      transform: translateX(-50%);
      width: 80%;
      height: 85%;
      transition: transform 0.1s linear;
    }
    @keyframes blink {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.2; }
    }
    .blink {
      animation: blink 2s ease-in-out infinite;
    }
    #launchButton {
      position: absolute;
      bottom: 30px;
      right: 30px;
      width: 80px;
      height: 80px;
      background: #cc0000;
      border: 4px solid #ffcc00;
      border-radius: 6px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-family: 'Arial Black', sans-serif;
      font-size: 12px;
      font-weight: bold;
      color: #fff;
      text-align: center;
      text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
      box-shadow: 0 0 15px rgba(255,204,0,0.5), inset 0 -3px 8px rgba(0,0,0,0.3);
      transition: all 0.2s ease;
      z-index: 100;
    }
    #launchButton:hover {
      background: #ff0000;
      box-shadow: 0 0 25px rgba(255,204,0,0.8), inset 0 -3px 8px rgba(0,0,0,0.3);
    }
    #launchButton:active {
      transform: scale(0.95);
    }
    #launchButton.launching {
      background: #00aa00;
      border-color: #00ff00;
      box-shadow: 0 0 25px rgba(0,255,0,0.8);
    }

    /* Smoke and flame container */
    #effectsLayer {
      position: absolute;
      bottom: 5px;
      left: calc(48% + 5px);
      transform: translateX(-50%);
      width: 80%;
      height: 85%;
      pointer-events: none;
      z-index: 10;
    }

    /* Smoke particle styles */
    .smoke-particle {
      position: absolute;
      border-radius: 50%;
      background: radial-gradient(circle, rgba(180,180,180,0.8) 0%, rgba(100,100,100,0.4) 50%, rgba(60,60,60,0) 100%);
      pointer-events: none;
      filter: blur(3px);
    }

    /* Flame styles */
    @keyframes flicker {
      0%, 100% { opacity: 1; transform: scaleY(1) scaleX(1); }
      25% { opacity: 0.9; transform: scaleY(1.05) scaleX(0.95); }
      50% { opacity: 0.95; transform: scaleY(0.95) scaleX(1.05); }
      75% { opacity: 0.85; transform: scaleY(1.02) scaleX(0.98); }
    }

    .flame {
      position: absolute;
      pointer-events: none;
      transform-origin: top center;
    }

    .flame-core {
      background: linear-gradient(to bottom,
        rgba(255,255,200,1) 0%,
        rgba(255,255,0,1) 20%,
        rgba(255,200,0,1) 40%,
        rgba(255,120,0,1) 60%,
        rgba(255,50,0,0.8) 80%,
        rgba(200,0,0,0) 100%);
      border-radius: 50% 50% 50% 50% / 20% 20% 80% 80%;
      animation: flicker 0.15s ease-in-out infinite;
    }

    .flame-outer {
      background: linear-gradient(to bottom,
        rgba(255,200,50,0.9) 0%,
        rgba(255,100,0,0.7) 40%,
        rgba(200,50,0,0.4) 70%,
        rgba(100,0,0,0) 100%);
      border-radius: 50% 50% 50% 50% / 20% 20% 80% 80%;
      animation: flicker 0.12s ease-in-out infinite reverse;
    }

    /* Status display */
    #statusDisplay {
      position: absolute;
      bottom: 130px;
      right: 30px;
      background: rgba(0,0,0,0.8);
      border: 2px solid #333;
      border-radius: 8px;
      padding: 15px;
      font-family: 'Courier New', monospace;
      font-size: 12px;
      color: #0f0;
      min-width: 180px;
      z-index: 100;
    }
    #statusDisplay .label {
      color: #888;
      font-size: 10px;
    }
    #statusDisplay .value {
      color: #0f0;
      font-weight: bold;
    }
    #statusDisplay .warning {
      color: #ff0;
    }
    #statusDisplay .critical {
      color: #f00;
    }
  </style>
</head>
<body>
  <!-- ADMIN HEADER -->
  <div class="admin-header">
    <div class="admin-header-left">
      <a href="/search" class="admin-header-logo">
        <span class="logo-jubilee">Jubilee</span><span class="logo-intelligence">Intelligence</span>
      </a>
    </div>
    <div class="admin-header-right">
      <span class="admin-header-user-name" id="adminUserName"></span>
      <span class="admin-header-sep">|</span>
      <a href="#" class="admin-sign-out-btn" id="adminAuthBtn">
        <span id="adminAuthBtnText">Sign Out</span>
        <svg viewBox="0 0 24 24" fill="none" stroke-linecap="round" stroke-linejoin="round">
          <path d="M12 4v8" stroke="currentColor" stroke-width="2.5"/>
          <path d="M6.5 7.5a8 8 0 1 0 11 0" stroke="currentColor" stroke-width="2" fill="none"/>
        </svg>
      </a>
    </div>
  </div>

  <!-- ADMIN LEFT SIDEBAR -->
  <div id="admin-sidebar-container">
    <div class="admin-sidebar">
      <a href="/admin" class="admin-sidebar-icon" data-tooltip="Dashboard" data-nav="dashboard">
        <svg viewBox="0 0 24 24"><path d="M3 13h8V3H3v10zm0 8h8v-6H3v6zm10 0h8V11h-8v10zm0-18v6h8V3h-8z"/></svg>
      </a>
      <a href="/search" class="admin-sidebar-icon" data-tooltip="Search" data-nav="search">
        <svg viewBox="0 0 24 24"><path d="M15.5 14h-.79l-.28-.27A6.47 6.47 0 0016 9.5 6.5 6.5 0 109.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/></svg>
      </a>
      <a href="/admin/tasks" class="admin-sidebar-icon" data-tooltip="Tasks" data-nav="tasks">
        <svg viewBox="0 0 24 24"><path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-9 14l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/></svg>
      </a>
      <a href="/admin/hospitality" class="admin-sidebar-icon" data-tooltip="Hospitality" data-nav="hospitality">
        <svg viewBox="0 0 24 24"><path d="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm3.5-9c.83 0 1.5-.67 1.5-1.5S16.33 8 15.5 8 14 8.67 14 9.5s.67 1.5 1.5 1.5zm-7 0c.83 0 1.5-.67 1.5-1.5S9.33 8 8.5 8 7 8.67 7 9.5 7.67 11 8.5 11zm3.5 6.5c2.33 0 4.31-1.46 5.11-3.5H6.89c.8 2.04 2.78 3.5 5.11 3.5z"/></svg>
      </a>
      <a href="/admin/collections" class="admin-sidebar-icon" data-tooltip="Collections" data-nav="collections">
        <svg viewBox="0 0 24 24"><path d="M4 6H2v14c0 1.1.9 2 2 2h14v-2H4V6zm16-4H8c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm0 14H8V4h12v12z"/></svg>
      </a>
      <div class="admin-sidebar-spacer"></div>
      <div class="admin-sidebar-brand-section">
        <div class="admin-sidebar-brand-text">Jubilee<span class="verse">Verse</span><span class="dotcom">.com</span></div>
        <div class="admin-sidebar-brand-sub">ADMIN DASHBOARD</div>
      </div>
      <div class="admin-sidebar-avatar">
        <img src="/images/personas/jubilee.png" alt="Admin">
      </div>
    </div>
  </div>

  <!-- Main content area -->
  <div class="launch-main-content">
    <!-- Effects layer for smoke and flames -->
    <div id="effectsLayer"></div>

    <svg id="launchPad" viewBox="0 0 800 900" preserveAspectRatio="xMidYMax meet">
    <defs>
      <!-- Steel structure gradient -->
      <linearGradient id="steelGrad" x1="0%" y1="0%" x2="100%" y2="0%">
        <stop offset="0%" stop-color="#2a2a2a"/>
        <stop offset="30%" stop-color="#4a4a4a"/>
        <stop offset="50%" stop-color="#5a5a5a"/>
        <stop offset="70%" stop-color="#4a4a4a"/>
        <stop offset="100%" stop-color="#2a2a2a"/>
      </linearGradient>

      <!-- Concrete gradient -->
      <linearGradient id="concreteGrad" x1="0%" y1="0%" x2="0%" y2="100%">
        <stop offset="0%" stop-color="#6a6a6a"/>
        <stop offset="50%" stop-color="#5a5a5a"/>
        <stop offset="100%" stop-color="#4a4a4a"/>
      </linearGradient>

      <!-- Red warning stripes -->
      <pattern id="warningStripes" patternUnits="userSpaceOnUse" width="20" height="20" patternTransform="rotate(45)">
        <rect width="10" height="20" fill="#cc3333"/>
        <rect x="10" width="10" height="20" fill="#ffcc00"/>
      </pattern>

      <!-- Rust/weathered metal -->
      <linearGradient id="rustGrad" x1="0%" y1="0%" x2="100%" y2="100%">
        <stop offset="0%" stop-color="#5a4030"/>
        <stop offset="50%" stop-color="#6a5040"/>
        <stop offset="100%" stop-color="#4a3525"/>
      </linearGradient>

      <!-- Orange service structure -->
      <linearGradient id="orangeGrad" x1="0%" y1="0%" x2="100%" y2="0%">
        <stop offset="0%" stop-color="#8B4513"/>
        <stop offset="30%" stop-color="#CD6600"/>
        <stop offset="50%" stop-color="#E87800"/>
        <stop offset="70%" stop-color="#CD6600"/>
        <stop offset="100%" stop-color="#8B4513"/>
      </linearGradient>

      <!-- Platform grating pattern -->
      <pattern id="gratingPattern" patternUnits="userSpaceOnUse" width="8" height="8">
        <rect width="8" height="8" fill="#3a3a3a"/>
        <line x1="0" y1="0" x2="8" y2="0" stroke="#555" stroke-width="0.5"/>
        <line x1="0" y1="4" x2="8" y2="4" stroke="#555" stroke-width="0.5"/>
        <line x1="0" y1="0" x2="0" y2="8" stroke="#555" stroke-width="0.5"/>
        <line x1="4" y1="0" x2="4" y2="8" stroke="#555" stroke-width="0.5"/>
      </pattern>
    </defs>

    <!-- ==================== MOBILE LAUNCHER PLATFORM (MLP) ==================== -->
    <g id="mlp">
      <!-- Main platform base -->
      <rect x="150" y="820" width="500" height="80" fill="url(#concreteGrad)" stroke="#333" stroke-width="2"/>

      <!-- Platform surface detail -->
      <rect x="155" y="825" width="490" height="15" fill="#5a5a5a" stroke="#444" stroke-width="0.5"/>

      <!-- Exhaust holes -->
      <rect x="280" y="835" width="80" height="60" fill="#111" stroke="#333" stroke-width="1"/>
      <rect x="440" y="835" width="80" height="60" fill="#111" stroke="#333" stroke-width="1"/>

      <!-- Hold-down posts -->
      <g fill="#4a4a4a" stroke="#333" stroke-width="1">
        <rect x="260" y="800" width="15" height="25"/>
        <rect x="340" y="800" width="15" height="25"/>
        <rect x="420" y="800" width="15" height="25"/>
        <rect x="525" y="800" width="15" height="25"/>
      </g>

      <!-- Tail Service Masts (TSM) -->
      <g id="tsm">
        <!-- Left TSM -->
        <rect x="200" y="650" width="20" height="170" fill="url(#steelGrad)" stroke="#333" stroke-width="1"/>
        <rect x="195" y="640" width="30" height="15" fill="url(#orangeGrad)" stroke="#5a3a15" stroke-width="0.5"/>
        <!-- Umbilical connections -->
        <rect x="220" y="680" width="35" height="8" fill="#444" stroke="#333" stroke-width="0.5"/>
        <rect x="220" y="710" width="35" height="8" fill="#444" stroke="#333" stroke-width="0.5"/>
        <rect x="220" y="740" width="35" height="8" fill="#444" stroke="#333" stroke-width="0.5"/>

        <!-- Right TSM -->
        <rect x="580" y="650" width="20" height="170" fill="url(#steelGrad)" stroke="#333" stroke-width="1"/>
        <rect x="575" y="640" width="30" height="15" fill="url(#orangeGrad)" stroke="#5a3a15" stroke-width="0.5"/>
        <!-- Umbilical connections -->
        <rect x="545" y="680" width="35" height="8" fill="#444" stroke="#333" stroke-width="0.5"/>
        <rect x="545" y="710" width="35" height="8" fill="#444" stroke="#333" stroke-width="0.5"/>
        <rect x="545" y="740" width="35" height="8" fill="#444" stroke="#333" stroke-width="0.5"/>
      </g>
    </g>

    <!-- ==================== FIXED SERVICE STRUCTURE (FSS) ==================== -->
    <g id="fss" transform="translate(20, 0)">
      <!-- Main tower vertical beams -->
      <rect x="30" y="100" width="25" height="720" fill="url(#steelGrad)" stroke="#222" stroke-width="1"/>
      <rect x="130" y="100" width="25" height="720" fill="url(#steelGrad)" stroke="#222" stroke-width="1"/>

      <!-- Cross bracing -->
      <g stroke="#4a4a4a" stroke-width="3">
        <!-- X-braces -->
        <line x1="35" y1="150" x2="150" y2="250"/>
        <line x1="150" y1="150" x2="35" y2="250"/>
        <line x1="35" y1="270" x2="150" y2="370"/>
        <line x1="150" y1="270" x2="35" y2="370"/>
        <line x1="35" y1="390" x2="150" y2="490"/>
        <line x1="150" y1="390" x2="35" y2="490"/>
        <line x1="35" y1="510" x2="150" y2="610"/>
        <line x1="150" y1="510" x2="35" y2="610"/>
        <line x1="35" y1="630" x2="150" y2="730"/>
        <line x1="150" y1="630" x2="35" y2="730"/>
      </g>

      <!-- Horizontal beams -->
      <g fill="url(#steelGrad)" stroke="#222" stroke-width="0.5">
        <rect x="30" y="145" width="125" height="8"/>
        <rect x="30" y="265" width="125" height="8"/>
        <rect x="30" y="385" width="125" height="8"/>
        <rect x="30" y="505" width="125" height="8"/>
        <rect x="30" y="625" width="125" height="8"/>
        <rect x="30" y="745" width="125" height="8"/>
      </g>

      <!-- Service platforms -->
      <g fill="url(#gratingPattern)" stroke="#333" stroke-width="1">
        <rect x="25" y="150" width="140" height="12"/>
        <rect x="25" y="270" width="140" height="12"/>
        <rect x="25" y="390" width="140" height="12"/>
        <rect x="25" y="510" width="140" height="12"/>
        <rect x="25" y="630" width="140" height="12"/>
        <rect x="25" y="750" width="140" height="12"/>
      </g>

      <!-- Platform railings -->
      <g stroke="#555" stroke-width="1.5" fill="none">
        <path d="M25 150 L25 138 M165 150 L165 138 M25 138 L165 138"/>
        <path d="M25 270 L25 258 M165 270 L165 258 M25 258 L165 258"/>
        <path d="M25 390 L25 378 M165 390 L165 378 M25 378 L165 378"/>
        <path d="M25 510 L25 498 M165 510 L165 498 M25 498 L165 498"/>
        <path d="M25 630 L25 618 M165 630 L165 618 M25 618 L165 618"/>
      </g>

      <!-- Lightning mast -->
      <rect x="70" y="20" width="12" height="90" fill="url(#steelGrad)" stroke="#333" stroke-width="0.5"/>
      <polygon points="76,0 72,20 80,20" fill="#666" stroke="#444" stroke-width="0.5"/>

      <!-- Top platform -->
      <rect x="20" y="95" width="150" height="12" fill="url(#gratingPattern)" stroke="#333" stroke-width="1"/>

      <!-- Hammerhead crane -->
      <rect x="60" y="85" width="30" height="15" fill="url(#steelGrad)" stroke="#333" stroke-width="0.5"/>
      <rect x="10" y="80" width="130" height="8" fill="url(#steelGrad)" stroke="#333" stroke-width="0.5"/>
    </g>

    <!-- ==================== FLAME TRENCH ==================== -->
    <g id="flameTrench">
      <rect x="100" y="870" width="600" height="30" fill="#222" stroke="#111" stroke-width="1"/>
      <!-- Flame deflector -->
      <path d="M320 870 L280 900 L520 900 L480 870 Z" fill="#3a3a3a" stroke="#222" stroke-width="1"/>
      <!-- Water deluge pipes -->
      <g fill="#4a6080" stroke="#334455" stroke-width="0.5">
        <rect x="160" y="860" width="12" height="15"/>
        <rect x="240" y="860" width="12" height="15"/>
        <rect x="548" y="860" width="12" height="15"/>
        <rect x="628" y="860" width="12" height="15"/>
      </g>
    </g>

    <!-- ==================== ADDITIONAL DETAILS ==================== -->
    <!-- Warning lights -->
    <g fill="#ff3333">
      <circle cx="95" cy="6" r="4" class="blink"/>
      <circle cx="173" cy="147" r="3"/>
      <circle cx="401" cy="164" r="3" class="blink"/>
    </g>

    <!-- Cable trays running down tower -->
    <g stroke="#555" stroke-width="2" fill="none">
      <path d="M60 110 L60 820"/>
      <path d="M145 110 L145 820"/>
    </g>

    <!-- Ground support equipment -->
    <g fill="#4a4a4a" stroke="#333" stroke-width="0.5">
      <rect x="50" y="840" width="40" height="30"/>
      <rect x="680" y="840" width="40" height="30"/>
    </g>

    <!-- Crawler way indicators -->
    <g fill="#666" stroke="#444" stroke-width="0.5">
      <rect x="100" y="895" width="600" height="5"/>
    </g>

    </svg>

    <!-- Status Display -->
    <div id="statusDisplay">
      <div><span class="label">STATUS:</span> <span class="value" id="statusText">READY</span></div>
      <div><span class="label">T-MINUS:</span> <span class="value" id="countdownText">--:--</span></div>
      <div><span class="label">THRUST:</span> <span class="value" id="thrustText">0%</span></div>
      <div><span class="label">ALTITUDE:</span> <span class="value" id="altitudeText">0 ft</span></div>
    </div>

    <div id="launchButton">
      LAUNCH
    </div>
  </div><!-- End launch-main-content -->

  <script>
    // Launch Sequence Controller
    const LaunchController = {
      isLaunching: false,
      animationFrameId: null,
      smokeParticles: [],
      flames: [],
      padOffset: 0,
      smokeIntensity: 0,
      flameIntensity: 0,
      countdown: 10,
      thrust: 0,
      altitude: 0,
      phase: 'idle', // idle, ignition, liftoff, ascending

      // Engine exhaust positions (in viewport percentages, relative to effects layer)
      enginePositions: {
        // Left SRB nozzle
        leftSRB: { x: 36, y: 88 },
        // Right SRB nozzle
        rightSRB: { x: 64, y: 88 },
        // Main engines (center cluster)
        mainLeft: { x: 46, y: 86 },
        mainCenter: { x: 50, y: 85 },
        mainRight: { x: 54, y: 86 }
      },

      init() {
        this.effectsLayer = document.getElementById('effectsLayer');
        this.launchPad = document.getElementById('launchPad');
        this.launchButton = document.getElementById('launchButton');
        this.statusText = document.getElementById('statusText');
        this.countdownText = document.getElementById('countdownText');
        this.thrustText = document.getElementById('thrustText');
        this.altitudeText = document.getElementById('altitudeText');

        this.launchButton.addEventListener('click', () => this.toggleLaunch());
      },

      toggleLaunch() {
        if (this.isLaunching) {
          this.resetLaunch();
        } else {
          this.startLaunch();
        }
      },

      startLaunch() {
        this.isLaunching = true;
        this.launchButton.classList.add('launching');
        this.launchButton.textContent = 'ABORT';
        this.phase = 'ignition';
        this.countdown = 10;
        this.smokeIntensity = 0;
        this.flameIntensity = 0;
        this.padOffset = 0;
        this.thrust = 0;
        this.altitude = 0;

        this.statusText.textContent = 'IGNITION SEQUENCE';
        this.statusText.className = 'value warning';

        // Start the countdown
        this.countdownInterval = setInterval(() => {
          this.countdown--;
          if (this.countdown <= 0) {
            clearInterval(this.countdownInterval);
            this.phase = 'liftoff';
            this.statusText.textContent = 'LIFTOFF!';
            this.statusText.className = 'value critical';
          }
          this.updateDisplay();
        }, 1000);

        // Start animation loop
        this.animate();
      },

      resetLaunch() {
        this.isLaunching = false;
        this.launchButton.classList.remove('launching');
        this.launchButton.textContent = 'LAUNCH';
        this.phase = 'idle';

        // Clear intervals
        if (this.countdownInterval) {
          clearInterval(this.countdownInterval);
        }

        // Cancel animation
        if (this.animationFrameId) {
          cancelAnimationFrame(this.animationFrameId);
        }

        // Clear all effects
        this.effectsLayer.innerHTML = '';
        this.smokeParticles = [];
        this.flames = [];

        // Reset pad position
        this.padOffset = 0;
        this.launchPad.style.transform = 'translateX(-50%) translateY(0px)';

        // Reset display
        this.statusText.textContent = 'READY';
        this.statusText.className = 'value';
        this.countdownText.textContent = '--:--';
        this.thrustText.textContent = '0%';
        this.altitudeText.textContent = '0 ft';
      },

      animate() {
        if (!this.isLaunching) return;

        const now = Date.now();

        // Update based on phase
        if (this.phase === 'ignition') {
          // Gradually increase smoke
          this.smokeIntensity = Math.min(1, this.smokeIntensity + 0.008);

          // Start flames after smoke builds (T-6)
          if (this.countdown <= 6) {
            this.flameIntensity = Math.min(0.6, this.flameIntensity + 0.015);
          }
        } else if (this.phase === 'liftoff') {
          // Full intensity
          this.smokeIntensity = 1;
          this.flameIntensity = Math.min(1, this.flameIntensity + 0.02);
          this.thrust = Math.min(100, this.thrust + 1.0);

          // Start moving pad down after thrust reaches 80%
          if (this.thrust >= 80) {
            this.phase = 'ascending';
          }
        } else if (this.phase === 'ascending') {
          // Maintain full effects
          this.smokeIntensity = 1;
          this.flameIntensity = 1;
          this.thrust = 100;

          // Move pad down (shuttle appears to rise)
          this.padOffset += 1.5;
          this.altitude = Math.floor(this.padOffset * 10);
          this.launchPad.style.transform = `translateX(-50%) translateY(${this.padOffset}px)`;
        }

        // Generate smoke particles
        this.generateSmoke();

        // Update smoke particles
        this.updateSmokeParticles();

        // Generate/update flames
        this.updateFlames();

        // Update display
        this.updateDisplay();

        this.animationFrameId = requestAnimationFrame(() => this.animate());
      },

      generateSmoke() {
        if (this.smokeIntensity <= 0) return;

        const particleCount = Math.floor(this.smokeIntensity * 8);

        for (let i = 0; i < particleCount; i++) {
          // Generate smoke from each engine position
          const engines = ['leftSRB', 'rightSRB', 'mainLeft', 'mainCenter', 'mainRight'];
          const engine = engines[Math.floor(Math.random() * engines.length)];
          const pos = this.enginePositions[engine];

          const particle = {
            x: pos.x + (Math.random() - 0.5) * 4,
            y: pos.y,
            size: 20 + Math.random() * 40 * this.smokeIntensity,
            opacity: 0.3 + Math.random() * 0.4 * this.smokeIntensity,
            vx: (Math.random() - 0.5) * 2,
            vy: 1 + Math.random() * 2,
            life: 1,
            element: null
          };

          // Create DOM element
          const el = document.createElement('div');
          el.className = 'smoke-particle';
          el.style.width = particle.size + 'px';
          el.style.height = particle.size + 'px';
          el.style.left = particle.x + '%';
          el.style.top = particle.y + '%';
          el.style.opacity = particle.opacity;
          el.style.transform = 'translate(-50%, -50%)';
          this.effectsLayer.appendChild(el);
          particle.element = el;

          this.smokeParticles.push(particle);
        }
      },

      updateSmokeParticles() {
        for (let i = this.smokeParticles.length - 1; i >= 0; i--) {
          const p = this.smokeParticles[i];

          // Update position
          p.x += p.vx * 0.1;
          p.y += p.vy * 0.15;
          p.size += 0.8;
          p.life -= 0.012;
          p.opacity *= 0.98;

          if (p.life <= 0 || p.opacity < 0.01) {
            // Remove particle
            p.element.remove();
            this.smokeParticles.splice(i, 1);
          } else {
            // Update element
            p.element.style.left = p.x + '%';
            p.element.style.top = p.y + '%';
            p.element.style.width = p.size + 'px';
            p.element.style.height = p.size + 'px';
            p.element.style.opacity = p.opacity * p.life;
          }
        }
      },

      updateFlames() {
        if (this.flameIntensity <= 0) {
          // Remove all flames
          this.flames.forEach(f => f.element.remove());
          this.flames = [];
          return;
        }

        // Create flames if not existing
        if (this.flames.length === 0) {
          const engines = [
            { ...this.enginePositions.leftSRB, type: 'srb' },
            { ...this.enginePositions.rightSRB, type: 'srb' },
            { ...this.enginePositions.mainLeft, type: 'main' },
            { ...this.enginePositions.mainCenter, type: 'main' },
            { ...this.enginePositions.mainRight, type: 'main' }
          ];

          engines.forEach((engine, idx) => {
            const flameContainer = document.createElement('div');
            flameContainer.className = 'flame';
            flameContainer.style.left = engine.x + '%';
            flameContainer.style.top = engine.y + '%';
            flameContainer.style.transform = 'translate(-50%, 0)';

            // Outer flame
            const outer = document.createElement('div');
            outer.className = 'flame-outer';
            outer.style.position = 'absolute';
            outer.style.left = '50%';
            outer.style.transform = 'translateX(-50%)';
            flameContainer.appendChild(outer);

            // Core flame
            const core = document.createElement('div');
            core.className = 'flame-core';
            core.style.position = 'absolute';
            core.style.left = '50%';
            core.style.transform = 'translateX(-50%)';
            flameContainer.appendChild(core);

            this.effectsLayer.appendChild(flameContainer);

            this.flames.push({
              element: flameContainer,
              outer: outer,
              core: core,
              type: engine.type,
              baseWidth: engine.type === 'srb' ? 30 : 20,
              baseHeight: engine.type === 'srb' ? 120 : 80
            });
          });
        }

        // Update flame sizes based on intensity
        this.flames.forEach(flame => {
          const width = flame.baseWidth * this.flameIntensity;
          const height = flame.baseHeight * this.flameIntensity * (0.9 + Math.random() * 0.2);

          flame.outer.style.width = (width * 1.5) + 'px';
          flame.outer.style.height = (height * 1.2) + 'px';
          flame.outer.style.top = '0';

          flame.core.style.width = width + 'px';
          flame.core.style.height = height + 'px';
          flame.core.style.top = '0';
        });
      },

      updateDisplay() {
        // Countdown
        if (this.countdown > 0) {
          this.countdownText.textContent = `T-${this.countdown}s`;
        } else {
          this.countdownText.textContent = 'T+' + Math.floor(-this.countdown) + 's';
          this.countdown -= 0.016; // Approximate frame time
        }

        // Thrust
        this.thrustText.textContent = Math.floor(this.thrust) + '%';

        // Altitude
        this.altitudeText.textContent = this.altitude.toLocaleString() + ' ft';
      }
    };

    // Initialize on DOM load
    document.addEventListener('DOMContentLoaded', () => {
      LaunchController.init();
    });
  </script>
</body>
</html>
